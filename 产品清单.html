<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>产品清单选择（审批专用）</title>
    <style>
        body { font-family: "Microsoft YaHei"; margin: 20px; background: #f5f7fa; }
        .container { max-width: 700px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #fafafa; }
        .selected { background: #e6f7ff; } /* 选中行样式 */
        #confirmBtn { 
            width: 100%; 
            padding: 12px; 
            background: #1890ff; 
            color: white; 
            border: none; 
            border-radius: 6px; 
            font-size: 16px; 
            cursor: pointer; 
            margin-top: 20px;
        }
        #confirmBtn:disabled { 
            background: #ccc; 
            cursor: not-allowed; 
        }
    </style>
    <!-- 引入企业微信JS-SDK -->
    <script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
</head>
<body>
    <div class="container">
        <h2>请选择需要审批的产品</h2>
        <table>
            <thead>
                <tr>
                    <th>选择</th>
                    <th>产品编号</th>
                    <th>产品名称</th>
                    <th>规格型号</th>
                    <th>单价（元）</th>
                </tr>
            </thead>
            <tbody>
                <tr onclick="selectProduct(this)">
                    <td><input type="radio" name="product" value="PRO001|办公笔记本电脑|联想小新Pro14|5999"></td>
                    <td>PRO001</td>
                    <td>办公笔记本电脑</td>
                    <td>联想小新Pro14</td>
                    <td>5999</td>
                </tr>
                <tr onclick="selectProduct(this)">
                    <td><input type="radio" name="product" value="PRO002|无线鼠标|罗技M220|89"></td>
                    <td>PRO002</td>
                    <td>无线鼠标</td>
                    <td>罗技M220</td>
                    <td>89</td>
                </tr>
                <tr onclick="selectProduct(this)">
                    <td><input type="radio" name="product" value="PRO003|打印纸|A4 80g|25"></td>
                    <td>PRO003</td>
                    <td>打印纸</td>
                    <td>A4 80g</td>
                    <td>25</td>
                </tr>
            </tbody>
        </table>
        <button id="confirmBtn" disabled>确定选择并返回审批</button>
    </div>

    <script>
        // 1. 全局变量：存储选中的产品
        let selectedProduct = null;

        // 2. 选择产品的逻辑
        function selectProduct(tr) {
            // 取消其他行选中状态
            document.querySelectorAll('tr').forEach(row => {
                row.classList.remove('selected');
                const radio = row.querySelector('input[name="product"]');
                if (radio) radio.checked = false;
            });
            // 选中当前行
            tr.classList.add('selected');
            const radio = tr.querySelector('input[name="product"]');
            radio.checked = true;
            // 保存选中的产品数据
            selectedProduct = radio.value;
            // 激活确定按钮
            document.getElementById('confirmBtn').disabled = false;
        }

        // 3. 企业微信JS-SDK初始化 + 数据回传逻辑
        document.getElementById('confirmBtn').addEventListener('click', function() {
            if (!selectedProduct) return;

            // 初始化企业微信JS-SDK（需替换为你的企业信息）
            wx.config({
                beta: true, // 必须打开
                debug: false, // 调试时可改为true
                appId: 'ww3ba73a3096cd2a0d', // 替换：企业微信管理后台的「企业ID」
                timestamp: new Date().getTime(), // 实际开发需后端生成，测试用当前时间
                nonceStr: 'randomStr', // 实际开发需后端生成，测试用固定值
                signature: 'testSignature', // 实际开发需后端生成，测试用固定值
                jsApiList: ['invoke'] // 必须包含invoke
            });

            // 初始化成功后，回传数据到审批界面
            wx.ready(function() {
                // 调用企业微信审批回传接口
                wx.invoke('invokeService', {
                    service: 'approval',
                    api: 'setApprovalFieldValue',
                    data: JSON.stringify({
                        // 回传的产品数据（审批表单会接收这个值）
                        value: selectedProduct 
                    })
                }, function(res) {
                    if (res.err_msg === 'invokeService:ok') {
                        // 回传成功，关闭当前网页，返回审批界面
                        wx.invoke('closeWindow', {}, function() {});
                    } else {
                        alert('数据回传失败：' + res.err_msg);
                    }
                });
            });

            // 初始化失败处理
            wx.error(function(res) {
                alert('JS-SDK初始化失败：' + res.err_msg);
            });
        });
    </script>
</body>
</html>
